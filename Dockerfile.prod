# Stage 1: Build
# Usamos la imagen oficial de Oracle para Java 25 (esta s√≠ existe)
FROM container-registry.oracle.com/java/openjdk:25 AS build
WORKDIR /app

COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN chmod +x mvnw
RUN ./mvnw dependency:go-offline

COPY src ./src
RUN ./mvnw clean package -DskipTests

# Stage 2: Runtime
FROM container-registry.oracle.com/java/openjdk:25
WORKDIR /app

COPY --from=build /app/target/*.jar app.jar

ENV JAVA_OPTS="-Xmx1536m -Xms512m"
EXPOSE 8080

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]